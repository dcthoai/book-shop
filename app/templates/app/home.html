
{% extends 'app/base.html' %}
{% load static %}

{% block home_title %}<title>Thế giới sách online - ABC Book</title>{% endblock home_title %}

{% block content %}

    {% comment %} Slider, banner ads {% endcomment %}
    <div class="slider grid">
        <div class="slider__content">
            <button class="prev-slide" type="button"><i class="fa-solid fa-angle-left"></i></button>
            <div class="wrapper">
                {% for slider in sliders %}
                    <a href="{{ slider.url }}" class="slider__link">
                        <div class="slider_link-item" style="background-image: url('{{ slider.image.url }}')"></div>
                    </a>
                {% endfor %}
            </div>
            <button class="next-slide" type="button"><i class="fa-solid fa-angle-right"></i></button>
        </div>

        <div class="slider__more">
            <a href="" class="slider__more-link">
                <div class="slider__more-img"></div>
            </a>
            <a href="" class="slider__more-link">
                <div class="slider__more-img"></div>
            </a>
        </div>
    </div>

    {% comment %} Most searched product suggestions {% endcomment %}
    <div class="content">
        <h2 class="content__heading">Tìm kiếm hàng đầu</h2>

        <div class="wrapper grid">
            {% for product in products %}
                <div class="book">
                    <a href="{% url 'book' product.slugName %}" class="book__link">
                        <div class="book__img" style="background-image: url({{product.imageURL}});"></div>
                        <div class="book__info">
                            <h4 class="info__name">{{product.name}}</h4>
                            <h4 class="info__price"><del>{{product.cost}}đ</del>  {{product.price}}đ</h4>
                        </div>
                    </a>

                    <button type="button" data-product="{{product.id}}" data-action="add" class="add-to-cart">Thêm vào giỏ hàng</button>
                </div>
            {% endfor %}
        </div>

        <div class="content__more">
            <button type="button" id="more-book-btn" class="content__more-btn">Xem thêm</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function(){
            var sliderControl = document.querySelector('.slider .slider__content .wrapper');
            var sliderLinks = document.querySelectorAll('.slider__link');
            var nextSlideBtn = document.querySelector('.slider .next-slide');
            var prevSlideBtn = document.querySelector('.slider .prev-slide');
            var intervalId, timeoutId;

            // Clone the first and last slide
            var firstSlide = sliderLinks[0].cloneNode(true);
            var lastSlide = sliderLinks[sliderLinks.length - 1].cloneNode(true);
            
            // Add the cloned slides to the beginning and end of the slider
            sliderControl.insertBefore(lastSlide, sliderControl.firstChild);
            sliderControl.appendChild(firstSlide);
            
            // Update the list of slides
            sliderLinks = document.querySelectorAll('.slider__link');
            var minIndex = -((sliderLinks.length - 1) * 760);
            var currentIndex = -760;

            function showSlide(index, isTransition){
                if(isTransition){
                    sliderControl.offsetHeight;
                    sliderControl.style.transition = 'all 500ms ease 0s';
                }else{
                    sliderControl.offsetHeight;
                    sliderControl.style.transition = 'all 0ms ease 0s';
                }
                sliderControl.style.transform = `translateX(${index}px)`;
                sliderControl.offsetHeight;
                sliderControl.style.transition = 'all 0ms ease 0s';
            }
        
            function nextSlide(){
                if(currentIndex - 760 == minIndex){
                    showSlide(currentIndex - 760, true);
                    currentIndex = -760;
                    setTimeout(function(){
                        showSlide(-760, false);
                    }, 500);
                }else{
                    showSlide(currentIndex - 760, true);
                    currentIndex -= 760;
                }
            }

            function prevSlide(){
                if(currentIndex + 760 == 0){
                    showSlide(0, true);
                    currentIndex = minIndex + 760;
                    setTimeout(function(){
                        showSlide(currentIndex, false);
                    }, 500);
                }else{
                    showSlide(currentIndex + 760, true);
                    currentIndex += 760;
                }
            }
                        
            showSlide(-760, false);
            function startSlider(){
                intervalId = setInterval(nextSlide, 4000);
            }
        
            nextSlideBtn.addEventListener('click', function() {
                if(nextSlideBtn.disabled)
                    return;
                nextSlideBtn.disabled = true;
                setTimeout(function(){
                    nextSlideBtn.disabled = false;
                }, 500);
                clearInterval(intervalId);
                clearTimeout(timeoutId);
                nextSlide();
                timeoutId = setTimeout(function(){
                    startSlider();
                }, 3000);
            });
        
            prevSlideBtn.addEventListener('click', function() {
                if(prevSlideBtn.disabled)
                    return;
                prevSlideBtn.disabled = true;
                setTimeout(function(){
                    prevSlideBtn.disabled = false;
                }, 500);
                clearInterval(intervalId);
                clearTimeout(timeoutId);
                prevSlide();
                timeoutId = setTimeout(function(){
                    startSlider();
                }, 3000);
            });

            startSlider();
        });         
    </script>

{% endblock content%}

{% block footer %}
    <footer class="footer">
        <div class="wrapper">
            <h2 class="heading">CONTACT US</h2>
            
            <div class="contact">
                <div class="contact__info">
                    <ul style="list-style: none;">
                        <li><i class="fa-solid fa-location-dot"></i>Chicago, US</li>
                        <li><i class="fa fa-phone"></i>Phone: +00 151515</li>
                        <li><i class="fa fa-envelope"></i>Email: mail@mail.com</li>
                    </ul>
                </div>

                <div class="contact__form">
                    <div class="form__input"><input type="text" placeholder="Name" ></div>
                    <div class="form__input"><input type="text" placeholder="Email"></div>
                    <div class="form__message"><input type="text" placeholder="Message"></div>
                    <button type="button" class="form__send-btn">SEND</button>
                </div>
            </div>
        </div>
    </footer>
{% endblock footer %}


