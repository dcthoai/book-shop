
{% extends 'app/base.html' %}
{% load static %}

{% block home_title %}<title>Thế giới sách online - ABC Book</title>{% endblock home_title %}

{% block content %}

    {% comment %} Slider, banner ads {% endcomment %}
    <div class="slider grid">
        <div class="slider__content">
            <button class="prev-slide" type="button"><i class="fa-solid fa-angle-left"></i></button>
            <div class="wrapper">
                {% for slider in sliders %}
                    <a href="{{ slider.url }}" class="slider__link">
                        <div class="slider_link-item" style="background-image: url({{ slider.image.url }})"></div>
                    </a>
                {% endfor %}
            </div>
            <button class="next-slide" type="button"><i class="fa-solid fa-angle-right"></i></button>
        </div>

        <div class="slider__more">
            <a href="" class="slider__more-link">
                <div class="slider__more-img" style="background-image: url({% static 'app/images/banner1.png' %});"></div>
            </a>
            <a href="" class="slider__more-link">
                <div class="slider__more-img" style="background-image: url({% static 'app/images/banner2.png' %});"></div>
            </a>
        </div>
    </div>

    {% comment %} Most searched product suggestions {% endcomment %}
    <div class="content">
        <div class="content__header">
            <h2 class="content__heading">Nổi bật</h2>

            <div class="content__filter">
                <h4>Danh mục</h4>
                <div class="content__filter-input">
                    <select class="filter-category" name="category">
                        <option value="category0">Nổi bật</option>
                        <option value="category1">Sách văn học</option>
                        <option value="category2">Sách kinh tế</option>
                        <option value="category3">Sách thiếu nhi</option>
                        <option value="category4">Sách giáo khoa</option>
                        <option value="category5">Sách ngoại ngữ</option>
                        <option value="category6">Tâm lý - kĩ năng sống</option>
                        <option value="category7">Tiểu sử - hồi ký</option>
                    </select>
                </div>
                <button class="content__filter-btn" type="button" id="filter-btn">Tìm kiếm</button>
            </div>
        </div>

        <div class="wrapper grid">
            {% comment %} List product {% endcomment %}
        </div>

        <div class="content__more">
            <button type="button" id="more-book-btn" class="content__more-btn">Xem thêm</button>
        </div>
    </div>

    <script>

        function fetchProductsByCategory(category) {
            fetch(`/filter-category?category=${category}`)
                .then(response => response.json())
                .then(products => {
                    if (products.length === 0){
                        return;
                    }
                    let productHTML = products.map(product => `
                        <div class="book">
                            <a href="/book/${product.slugName}" class="book__link">
                                <div class="book__img" style="background-image: url(${product.imageURL});"></div>
                                <div class="book__info">
                                    <h4 class="info__name">${product.name}</h4>
                                    <h4 class="info__price"><del>${product.cost}đ</del>  ${product.price}đ</h4>
                                </div>
                            </a>

                            <button type="button" data-product="${product.id}" data-action="add" class="add-to-cart">Thêm vào giỏ hàng</button>
                        </div>
                    `).join('');

                    content.innerHTML = '';

                    $('#more-book-btn').hide();

                    content.innerHTML += productHTML;

                    addCartEventListeners();
                });
        }

        $(document).on('click', '#filter-btn', function(e){
            e.preventDefault();
            var select = $('.filter-category option:checked');
            if(select.val() == 'category0') {
                window.location.href = '{% url "home" %}';
            }
            else {
                category = select.val();
                $('.content__heading').text(select.text());
                fetchProductsByCategory(category);
            }
        });


    </script>

    <script src="{% static 'app/js/cart.js' %}"></script>
    <script src="{% static 'app/js/home.js' %}"></script>

{% endblock content%}

{% block footer %}
    <footer class="footer">
        <div class="wrapper">
            <h2 class="heading">CONTACT US</h2>
            
            <div class="contact">
                <div class="contact__info">
                    <ul style="list-style: none;">
                        <li><i class="fa-solid fa-location-dot"></i>Chicago, US</li>
                        <li><i class="fa fa-phone"></i>Phone: +00 151515</li>
                        <li><i class="fa fa-envelope"></i>Email: mail@mail.com</li>
                    </ul>
                </div>

                <div class="contact__form">
                    <div class="form__input"><input type="text" placeholder="Name" ></div>
                    <div class="form__input"><input type="text" placeholder="Email"></div>
                    <div class="form__message"><input type="text" placeholder="Message"></div>
                    <button type="button" class="form__send-btn">SEND</button>
                </div>
            </div>
        </div>
    </footer>
{% endblock footer %}